import{m as re,u as me}from"./mount-component-94eea14a.js";import{m as ue,c as Q,l as A,H as x,L as ve,q as J,w as ge,o as de,p as fe,d as he,e as we}from"./use-translate-0400f29b.js";import{u as ee}from"./use-expose-efcfdee3.js";import{I as Pe}from"./index-5a7b6df9.js";import{a as Se,S as ye}from"./index-d928a42a.js";import{P as Ie}from"./index-4c6d2d8c.js";import{u as be}from"./use-touch-8cd17a21.js";import{I as Ce}from"./index-74bb5fae.js";import{L as xe}from"./index-e6476cbd.js";import{A as oe,H as te,y as p,D,u as z,e as v,M as Te,q as Ye,B as ae,Q as Xe}from"./vue-libs-83dbabed.js";import{d as M,n as q,t as Z,b as Oe,c as N,u as F,m as U}from"./with-install-a78877b5.js";import{T as V,L as Ze,H as Re}from"./constant-ee6e27d7.js";import{c as pe}from"./interceptor-3c3c2616.js";const G=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),ze=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),B=Q("image-preview")[1],K=2.6,He={src:String,show:Boolean,active:Number,minZoom:M(q),maxZoom:M(q),rootWidth:M(Number),rootHeight:M(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickOverlay:Boolean},ke=oe({props:He,emits:["scale","close","longPress"],setup(e,{emit:l,slots:g}){const o=te({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),m=be(),n=p(),S=p(),T=p(!1),f=p(!1);let Y=0;const H=D(()=>{const{scale:t,moveX:a,moveY:s,moving:c,zooming:r,initializing:h}=o,k={transitionDuration:r||c||h?"0s":".3s"};return(t!==1||f.value)&&(k.transform=`matrix(${t}, 0, 0, ${t}, ${a}, ${s})`),k}),d=D(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:a}=e,s=T.value?a/o.imageRatio:t;return Math.max(0,(o.scale*s-t)/2)}return 0}),w=D(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:a}=e,s=T.value?a:t*o.imageRatio;return Math.max(0,(o.scale*s-a)/2)}return 0}),X=(t,a)=>{var s;if(t=x(t,+e.minZoom,+e.maxZoom+1),t!==o.scale){const c=t/o.scale;if(o.scale=t,a){const r=J((s=n.value)==null?void 0:s.$el),h={x:r.width*.5,y:r.height*.5},k=o.moveX-(a.x-r.left-h.x)*(c-1),ce=o.moveY-(a.y-r.top-h.y)*(c-1);o.moveX=x(k,-d.value,d.value),o.moveY=x(ce,-w.value,w.value)}else o.moveX=0,o.moveY=f.value?Y:0;l("scale",{scale:t,index:e.active})}},y=()=>{X(1)},E=()=>{const t=o.scale>1?1:2;X(t,t===2||f.value?{x:m.startX.value,y:m.startY.value}:void 0)};let I,O,b,i,P,u,C,L,$=!1;const ie=t=>{const{touches:a}=t;if(I=a.length,I===2&&e.disableZoom)return;const{offsetX:s}=m;m.start(t),O=o.moveX,b=o.moveY,L=Date.now(),$=!1,o.moving=I===1&&(o.scale!==1||f.value),o.zooming=I===2&&!s.value,o.zooming&&(i=o.scale,P=G(a))},se=t=>{const{touches:a}=t;if(m.move(t),o.moving){const{deltaX:s,deltaY:c}=m,r=s.value+O,h=c.value+b;if((r>d.value||r<-d.value)&&!$&&m.isHorizontal()){o.moving=!1;return}$=!0,A(t,!0),o.moveX=x(r,-d.value,d.value),o.moveY=x(h,-w.value,w.value)}if(o.zooming&&(A(t,!0),a.length===2)){const s=G(a),c=i*s/P;u=ze(a),X(c,u)}},ne=t=>{var h;if(I>1)return;const{offsetX:a,offsetY:s}=m,c=Date.now()-L,r=250;if(a.value<V&&s.value<V)if(c<r)if(e.doubleScale)if(C)clearTimeout(C),C=null,E();else{if(!e.closeOnClickOverlay&&t.target===((h=S.value)==null?void 0:h.$el))return;C=setTimeout(()=>{l("close"),C=null},r)}else l("close");else c>Ze&&l("longPress")},_=t=>{let a=!1;if((o.moving||o.zooming)&&(a=!0,o.moving&&O===o.moveX&&b===o.moveY&&(a=!1),!t.touches.length)){o.zooming&&(o.moveX=x(o.moveX,-d.value,d.value),o.moveY=x(o.moveY,-w.value,w.value),o.zooming=!1),o.moving=!1,O=0,b=0,i=1,o.scale<1&&y();const s=+e.maxZoom;o.scale>s&&X(s,u)}A(t,a),ne(t),m.reset()},j=()=>{const{rootWidth:t,rootHeight:a}=e,s=a/t,{imageRatio:c}=o;T.value=o.imageRatio>s&&c<K,f.value=o.imageRatio>s&&c>=K,f.value&&(Y=(c*t-a)/2,o.moveY=Y,o.initializing=!0,ve(()=>{o.initializing=!1})),y()},le=t=>{const{naturalWidth:a,naturalHeight:s}=t.target;o.imageRatio=s/a,j()};return z(()=>e.active,y),z(()=>e.show,t=>{t||y()}),z(()=>[e.rootWidth,e.rootHeight],j),ue("touchmove",se,{target:D(()=>{var t;return(t=S.value)==null?void 0:t.$el})}),ee({resetScale:y}),()=>{const t={loading:()=>v(xe,{type:"spinner"},null)};return v(Se,{ref:S,class:B("swipe-item"),onTouchstartPassive:ie,onTouchend:_,onTouchcancel:_},{default:()=>[g.image?v("div",{class:B("image-wrap")},[g.image({src:e.src})]):v(Ce,{ref:n,src:e.src,fit:"contain",class:B("image",{vertical:T.value}),style:H.value,onLoad:le},t)]})}}});function De(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Xe(e)}const[Me,R]=Q("image-preview"),Ne=["show","teleport","transition","overlayStyle","closeOnPopstate"],We={show:Boolean,loop:Z,images:Oe(),minZoom:N(1/3),maxZoom:N(3),overlay:Z,closeable:Boolean,showIndex:Z,className:F,closeIcon:U("clear"),transition:String,beforeClose:Function,doubleScale:Z,overlayClass:F,overlayStyle:Object,swipeDuration:N(300),startPosition:N(0),showIndicators:Boolean,closeOnPopstate:Z,closeOnClickOverlay:Z,closeIconPosition:U("top-right"),teleport:[String,Object]},Ee=oe({name:Me,props:We,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:l,slots:g}){const o=p(),m=p(),n=te({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),S=()=>{if(o.value){const i=J(o.value.$el);n.rootWidth=i.width,n.rootHeight=i.height,o.value.resize()}},T=i=>l("scale",i),f=i=>l("update:show",i),Y=()=>{pe(e.beforeClose,{args:[n.active],done:()=>f(!1)})},H=i=>{i!==n.active&&(n.active=i,l("change",i))},d=()=>{if(e.showIndex)return v("div",{class:R("index")},[g.index?g.index({index:n.active}):`${n.active+1} / ${e.images.length}`])},w=()=>{if(g.cover)return v("div",{class:R("cover")},[g.cover()])},X=()=>{n.disableZoom=!0},y=()=>{n.disableZoom=!1},E=()=>{let i;return v(ye,{ref:o,lazyRender:!0,loop:e.loop,class:R("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:H,onDragEnd:y,onDragStart:X},De(i=e.images.map((P,u)=>v(ke,{ref:C=>{u===n.active&&(m.value=C)},src:P,show:e.show,active:n.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:n.rootWidth,rootHeight:n.rootHeight,disableZoom:n.disableZoom,doubleScale:e.doubleScale,closeOnClickOverlay:e.closeOnClickOverlay,onScale:T,onClose:Y,onLongPress:()=>l("longPress",{index:u})},{image:g.image})))?i:{default:()=>[i]})},I=()=>{if(e.closeable)return v(Pe,{role:"button",name:e.closeIcon,class:[R("close-icon",e.closeIconPosition),Re],onClick:Y},null)},O=()=>l("closed"),b=(i,P)=>{var u;return(u=o.value)==null?void 0:u.swipeTo(i,P)};return ee({resetScale:()=>{var i;(i=m.value)==null||i.resetScale()},swipeTo:b}),Te(S),z([ge,de],S),z(()=>e.startPosition,i=>H(+i)),z(()=>e.show,i=>{const{images:P,startPosition:u}=e;i?(H(+u),Ye(()=>{S(),b(+u,{immediate:!0})})):l("close",{index:n.active,url:P[n.active]})}),()=>v(Ie,ae({class:[R(),e.className],overlayClass:[R("overlay"),e.overlayClass],onClosed:O,"onUpdate:show":f},fe(e,Ne)),{default:()=>[I(),E(),d(),w()]})}});let W;const $e={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function Ae(){({instance:W}=re({setup(){const{state:e,toggle:l}=me(),g=()=>{e.images=[]};return()=>v(Ee,ae(e,{onClosed:g,"onUpdate:show":l}),null)}}))}const oo=(e,l=0)=>{if(he)return W||Ae(),e=Array.isArray(e)?{images:e,startPosition:l}:e,W.open(we({},$e,e)),W};export{Ee as _,oo as s};
