import{d as y,w as z,c as N,q as V,l as x,a as j}from"./use-translate-0400f29b.js";import{u as I}from"./use-expose-efcfdee3.js";import{B}from"./index-33a62985.js";import{A as M,y as w,D as F,u as H,M as X,e as a,r as Y,o as T,a as q,w as v,C as s,c as A,f as J,F as $}from"./vue-libs-83dbabed.js";import{m as b,a as G,w as K}from"./with-install-a78877b5.js";import{V as O}from"./index-74bb5fae.js";import{s as Q}from"./function-call-b65aa903.js";import"./use-route-b1061918.js";import"./index-5a7b6df9.js";import"./index-c916422a.js";import"./index-e6476cbd.js";import"./constant-ee6e27d7.js";import"./mount-component-94eea14a.js";import"./index-4c6d2d8c.js";import"./use-lock-scroll-1eff2e8c.js";import"./use-touch-8cd17a21.js";import"./use-lazy-render-2383afef.js";import"./on-popup-reopen-bcf43cef.js";import"./use-scope-id-e548748d.js";import"./index-b7134fb7.js";import"./interceptor-3c3c2616.js";const[Z,k,W]=N("signature"),tt={tips:String,type:b("png"),penColor:b("#000"),lineWidth:G(3),clearButtonText:String,backgroundColor:b(""),confirmButtonText:String},et=()=>{var n;const o=document.createElement("canvas");return!!((n=o.getContext)!=null&&n.call(o,"2d"))},ot=M({name:Z,props:tt,emits:["submit","clear","start","end","signing"],setup(o,{emit:n}){const r=w(),u=w(),e=F(()=>r.value?r.value.getContext("2d"):null),f=y?et():!0;let g=0,i=0,m;const D=()=>{if(!e.value)return!1;e.value.beginPath(),e.value.lineWidth=o.lineWidth,e.value.strokeStyle=o.penColor,m=V(r),n("start")},R=t=>{if(!e.value)return!1;x(t);const l=t.touches[0],c=l.clientX-((m==null?void 0:m.left)||0),d=l.clientY-((m==null?void 0:m.top)||0);e.value.lineCap="round",e.value.lineJoin="round",e.value.lineTo(c,d),e.value.stroke(),n("signing",t)},E=t=>{x(t),n("end")},P=t=>{const l=document.createElement("canvas");if(l.width=t.width,l.height=t.height,o.backgroundColor){const c=l.getContext("2d");C(c)}return t.toDataURL()===l.toDataURL()},C=t=>{t&&o.backgroundColor&&(t.fillStyle=o.backgroundColor,t.fillRect(0,0,g,i))},U=()=>{var d,p;const t=r.value;if(!t)return;const c=P(t)?"":((p=(d={jpg:()=>t.toDataURL("image/jpeg",.8),jpeg:()=>t.toDataURL("image/jpeg",.8)})[o.type])==null?void 0:p.call(d))||t.toDataURL(`image/${o.type}`);n("submit",{image:c,canvas:t})},L=()=>{e.value&&(e.value.clearRect(0,0,g,i),e.value.closePath(),C(e.value)),n("clear")},S=()=>{var t,l,c;if(f&&r.value){const d=r.value,p=y?window.devicePixelRatio:1;g=d.width=(((t=u.value)==null?void 0:t.offsetWidth)||0)*p,i=d.height=(((l=u.value)==null?void 0:l.offsetHeight)||0)*p,(c=e.value)==null||c.scale(p,p),C(e.value)}},_=()=>{if(e.value){const t=e.value.getImageData(0,0,g,i);S(),e.value.putImageData(t,0,0)}};return H(z,_),X(S),I({resize:_}),()=>a("div",{class:k()},[a("div",{class:k("content"),ref:u},[f?a("canvas",{ref:r,onTouchstartPassive:D,onTouchmove:R,onTouchend:E},null):a("p",null,[o.tips])]),a("div",{class:k("footer")},[a(B,{size:"small",onClick:L},{default:()=>[o.clearButtonText||W("clear")]}),a(B,{type:"primary",size:"small",onClick:U},{default:()=>[o.confirmButtonText||W("confirm")]})])])}}),at=K(ot),h=at,xt={__name:"index",setup(o){const n=j({"zh-CN":{penColor:"自定义颜色",lineWidth:"自定义线宽",backgroundColor:"自定义背景颜色"},"en-US":{penColor:"Pen Color",lineWidth:"Line Width",backgroundColor:"Background Color"}}),r=w(""),u=f=>{r.value=f.image},e=()=>Q("clear");return(f,g)=>{const i=Y("demo-block");return T(),q($,null,[a(i,{title:s(n)("basicUsage")},{default:v(()=>[a(s(h),{onSubmit:u,onClear:e})]),_:1},8,["title"]),r.value?(T(),A(s(O),{key:0,src:r.value},null,8,["src"])):J("",!0),a(i,{title:s(n)("penColor")},{default:v(()=>[a(s(h),{"pen-color":"#ff0000",onClear:e,onSubmit:u})]),_:1},8,["title"]),a(i,{title:s(n)("lineWidth")},{default:v(()=>[a(s(h),{"line-width":6,onClear:e,onSubmit:u})]),_:1},8,["title"]),a(i,{title:s(n)("backgroundColor")},{default:v(()=>[a(s(h),{"background-color":"#eee",onClear:e,onSubmit:u})]),_:1},8,["title"])],64)}}};export{xt as default};
