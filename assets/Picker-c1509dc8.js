import{c as R,i as Te,e as w,H as J,u as ae,m as le,l as ce,b as ie,p as Q,I as Y,J as pe}from"./use-translate-0400f29b.js";import{u as se}from"./use-expose-efcfdee3.js";import{L as Oe}from"./index-e6476cbd.js";import{u as xe}from"./use-touch-8cd17a21.js";import{n as L,d as D,b as V,c as N,t as Ce,m as ye}from"./with-install-a78877b5.js";import{A as $,y as E,D as k,R as ke,e as m,U as Se,Q as Pe,u as G,B as Ee,q as X}from"./vue-libs-83dbabed.js";import{H as Z,a as we}from"./constant-ee6e27d7.js";import{u as Ie}from"./use-sync-prop-ref-60eae172.js";import{T as He,a as Be}from"./index-3bb89b35.js";const[Me,C,ee]=R("picker"),ue=e=>e.find(a=>!a.disabled)||e[0];function De(e,a){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(a.children in n)return"cascade"}return"default"}function _(e,a){a=J(a,0,e.length);for(let n=a;n<e.length;n++)if(!e[n].disabled)return n;for(let n=a-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const te=(e,a,n)=>a!==void 0&&!!e.find(i=>i[n.value]===a);function W(e,a,n){const i=e.findIndex(v=>v[n.value]===a),c=_(e,i);return e[c]}function Ne(e,a,n){const i=[];let c={[a.children]:e},v=0;for(;c&&c[a.children];){const f=c[a.children],h=n.value[v];if(c=Te(h)?W(f,h,a):void 0,!c&&f.length){const u=ue(f)[a.value];c=W(f,u,a)}v++,i.push(f)}return i}function _e(e){const{transform:a}=window.getComputedStyle(e),n=a.slice(7,a.length-1).split(", ")[5];return Number(n)}function Ve(e){return w({text:"text",value:"value",children:"children"},e)}const ne=200,oe=300,Re=15,[re,q]=R("picker-column"),me=Symbol(re),$e=$({name:re,props:{value:L,fields:D(Object),options:V(),readonly:Boolean,allowHtml:Boolean,optionHeight:D(Number),swipeDuration:D(L),visibleOptionNum:D(L)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:n}){let i,c,v,f,h;const u=E(),b=E(),r=E(0),d=E(0),T=xe(),p=()=>e.options.length,g=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,O=s=>{let t=_(e.options,s);const o=-t*e.optionHeight,l=()=>{t>p()-1&&(t=_(e.options,s));const y=e.options[t][e.fields.value];y!==e.value&&a("change",y)};i&&o!==r.value?h=l:l(),r.value=o},x=()=>e.readonly||!e.options.length,U=s=>{i||x()||(h=null,d.value=ne,O(s),a("clickOption",e.options[s]))},S=s=>J(Math.round(-s/e.optionHeight),0,p()-1),M=k(()=>S(r.value)),j=(s,t)=>{const o=Math.abs(s/t);s=r.value+o/.003*(s<0?-1:1);const l=S(s);d.value=+e.swipeDuration,O(l)},I=()=>{i=!1,d.value=0,h&&(h(),h=null)},F=s=>{if(!x()){if(T.start(s),i){const t=_e(b.value);r.value=Math.min(0,t-g())}d.value=0,c=r.value,v=Date.now(),f=c,h=null}},K=s=>{if(x())return;T.move(s),T.isVertical()&&(i=!0,ce(s,!0));const t=J(c+T.deltaY.value,-(p()*e.optionHeight),e.optionHeight),o=S(t);o!==M.value&&a("scrollInto",e.options[o]),r.value=t;const l=Date.now();l-v>oe&&(v=l,f=t)},H=()=>{if(x())return;const s=r.value-f,t=Date.now()-v;if(t<oe&&Math.abs(s)>Re){j(s,t);return}const l=S(r.value);d.value=ne,O(l),setTimeout(()=>{i=!1},0)},P=()=>{const s={height:`${e.optionHeight}px`};return e.options.map((t,o)=>{const l=t[e.fields.text],{disabled:y}=t,B=t[e.fields.value],be={role:"button",style:s,tabindex:y?-1:0,class:[q("item",{disabled:y,selected:B===e.value}),t.className],onClick:()=>U(o)},ge={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:l};return m("li",be,[n.option?n.option(t,o):m("div",ge,null)])})};return ae(me),se({stopMomentum:I}),ke(()=>{const s=i?Math.floor(-r.value/e.optionHeight):e.options.findIndex(l=>l[e.fields.value]===e.value),t=_(e.options,s),o=-t*e.optionHeight;i&&t<s&&I(),r.value=o}),le("touchmove",K,{target:u}),()=>m("div",{ref:u,class:q(),onTouchstartPassive:F,onTouchend:H,onTouchcancel:H},[m("ul",{ref:b,style:{transform:`translate3d(0, ${r.value+g()}px, 0)`,transitionDuration:`${d.value}ms`,transitionProperty:d.value?"all":"none"},class:q("wrapper"),onTransitionend:I},[P()])])}}),[Ae]=R("picker-toolbar"),A={title:String,cancelButtonText:String,confirmButtonText:String},fe=["cancel","confirm","title","toolbar"],Ue=Object.keys(A),de=$({name:Ae,props:A,emits:["confirm","cancel"],setup(e,{emit:a,slots:n}){const i=()=>{if(n.title)return n.title();if(e.title)return m("div",{class:[C("title"),"van-ellipsis"]},[e.title])},c=()=>a("cancel"),v=()=>a("confirm"),f=()=>{const u=e.cancelButtonText||ee("cancel");return m("button",{type:"button",class:[C("cancel"),Z],onClick:c},[n.cancel?n.cancel():u])},h=()=>{const u=e.confirmButtonText||ee("confirm");return m("button",{type:"button",class:[C("confirm"),Z],onClick:v},[n.confirm?n.confirm():u])};return()=>m("div",{class:C("toolbar")},[n.toolbar?n.toolbar():[f(),i(),h()]])}});function je(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Pe(e)}const[ve,z]=R("picker-group"),he=Symbol(ve),Fe=w({tabs:V(),activeTab:N(0),nextStepText:String},A),et=$({name:ve,props:Fe,emits:["confirm","cancel","update:activeTab"],setup(e,{emit:a,slots:n}){const i=Ie(()=>e.activeTab,b=>a("update:activeTab",b)),{children:c,linkChildren:v}=ie(he);v();const f=()=>+i.value<e.tabs.length-1&&e.nextStepText,h=()=>{f()?i.value=+i.value+1:a("confirm",c.map(b=>b.confirm()))},u=()=>a("cancel");return()=>{var T,p;let b;const r=(p=(T=n.default)==null?void 0:T.call(n))==null?void 0:p.filter(g=>g.type!==Se),d=f()?e.nextStepText:e.confirmButtonText;return m("div",{class:z()},[m(de,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:d,onConfirm:h,onCancel:u},Q(n,fe)),m(He,{active:i.value,"onUpdate:active":g=>i.value=g,class:z("tabs"),shrink:!0,animated:!0,lazyRender:!1},je(b=e.tabs.map((g,O)=>m(Be,{title:g,titleClass:z("tab-title")},{default:()=>[r==null?void 0:r[O]]})))?b:{default:()=>[b]})])}}}),Ke=w({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:N(44),showToolbar:Ce,swipeDuration:N(1e3),visibleOptionNum:N(6)},A),Ye=w({},Ke,{columns:V(),modelValue:V(),toolbarPosition:ye("top"),columnsFieldNames:Object}),tt=$({name:Me,props:Ye,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:n}){const i=E(),c=E(e.modelValue.slice(0)),{parent:v}=ae(he),{children:f,linkChildren:h}=ie(me);h();const u=k(()=>Ve(e.columnsFieldNames)),b=k(()=>pe(e.optionHeight)),r=k(()=>De(e.columns,u.value)),d=k(()=>{const{columns:t}=e;switch(r.value){case"multiple":return t;case"cascade":return Ne(t,u.value,c);default:return[t]}}),T=k(()=>d.value.some(t=>t.length)),p=k(()=>d.value.map((t,o)=>W(t,c.value[o],u.value))),g=k(()=>d.value.map((t,o)=>t.findIndex(l=>l[u.value.value]===c.value[o]))),O=(t,o)=>{if(c.value[t]!==o){const l=c.value.slice(0);l[t]=o,c.value=l}},x=()=>({selectedValues:c.value.slice(0),selectedOptions:p.value,selectedIndexes:g.value}),U=(t,o)=>{O(o,t),r.value==="cascade"&&c.value.forEach((l,y)=>{const B=d.value[y];te(B,l,u.value)||O(y,B.length?B[0][u.value.value]:void 0)}),X(()=>{a("change",w({columnIndex:o},x()))})},S=(t,o)=>{const l={columnIndex:o,currentOption:t};a("clickOption",w(x(),l)),a("scrollInto",l)},M=()=>{f.forEach(o=>o.stopMomentum());const t=x();return X(()=>{a("confirm",t)}),t},j=()=>a("cancel",x()),I=()=>d.value.map((t,o)=>m($e,{value:c.value[o],fields:u.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:b.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:l=>U(l,o),onClickOption:l=>S(l,o),onScrollInto:l=>{a("scrollInto",{currentOption:l,columnIndex:o})}},{option:n.option})),F=t=>{if(T.value){const o={height:`${b.value}px`},l={backgroundSize:`100% ${(t-b.value)/2}px`};return[m("div",{class:C("mask"),style:l},null),m("div",{class:[we,C("frame")],style:o},null)]}},K=()=>{const t=b.value*+e.visibleOptionNum,o={height:`${t}px`};return m("div",{ref:i,class:C("columns"),style:o},[I(),F(t)])},H=()=>{if(e.showToolbar&&!v)return m(de,Ee(Q(e,Ue),{onConfirm:M,onCancel:j}),Q(n,fe))};G(d,t=>{t.forEach((o,l)=>{o.length&&!te(o,c.value[l],u.value)&&O(l,ue(o)[u.value.value])})},{immediate:!0});let P;return G(()=>e.modelValue,t=>{!Y(t,c.value)&&!Y(t,P)&&(c.value=t.slice(0),P=t.slice(0))},{deep:!0}),G(c,t=>{Y(t,e.modelValue)||(P=t.slice(0),a("update:modelValue",P))},{immediate:!0}),le("touchmove",ce,{target:i}),se({confirm:M,getSelectedOptions:()=>p.value}),()=>{var t,o;return m("div",{class:C()},[e.toolbarPosition==="top"?H():null,e.loading?m(Oe,{class:C("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),K(),(o=n["columns-bottom"])==null?void 0:o.call(n),e.toolbarPosition==="bottom"?H():null])}}});export{tt as _,et as a,Ke as p};
